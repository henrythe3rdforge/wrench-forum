{% extends "base.html" %}

{% block title %}{{ category.name | default(value="Category") }} - Wrench Forum{% endblock %}

{% block content %}
<div class="forum-layout">
    <aside class="sidebar">
        <h3>Categories</h3>
        <ul class="category-list">
            {% for cat in categories %}
            <li class="{% if cat.slug == current_slug %}active{% endif %}">
                <a href="/category/{{ cat.slug }}">{{ cat.name }}</a>
            </li>
            {% endfor %}
        </ul>
        
        {% if user and user.role != "Unverified" %}
        <a href="/post/new" class="btn btn-primary">New Post</a>
        {% elif user %}
        <div class="verify-prompt">
            <p>Verify your mechanic credentials to post</p>
            <a href="/verification" class="btn btn-secondary">Get Verified</a>
        </div>
        {% endif %}
    </aside>
    
    <section class="main-content">
        {% if category %}
        <div class="category-header">
            <h1>{{ category.name }}</h1>
            <p>{{ category.description }}</p>
        </div>
        {% endif %}
        
        <div class="sort-tabs">
            <a href="/category/{{ current_slug }}?sort=hot" class="tab {% if sort == 'hot' %}active{% endif %}">üî• Hot</a>
            <a href="/category/{{ current_slug }}?sort=new" class="tab {% if sort == 'new' %}active{% endif %}">üïê New</a>
            <a href="/category/{{ current_slug }}?sort=top" class="tab {% if sort == 'top' %}active{% endif %}">‚¨ÜÔ∏è Top</a>
        </div>
        
        <div class="post-list">
            {% for post in posts %}
            <article class="post-card">
                <div class="vote-controls">
                    {% if user %}
                    <button class="vote-btn upvote" 
                            hx-post="/post/{{ post.id }}/vote" 
                            hx-vals='{"value": 1}'
                            hx-target="#score-{{ post.id }}"
                            hx-swap="innerHTML">‚ñ≤</button>
                    {% else %}
                    <span class="vote-btn disabled">‚ñ≤</span>
                    {% endif %}
                    <span id="score-{{ post.id }}" class="score">{{ post.score }}</span>
                    {% if user %}
                    <button class="vote-btn downvote" 
                            hx-post="/post/{{ post.id }}/vote" 
                            hx-vals='{"value": -1}'
                            hx-target="#score-{{ post.id }}"
                            hx-swap="innerHTML">‚ñº</button>
                    {% else %}
                    <span class="vote-btn disabled">‚ñº</span>
                    {% endif %}
                </div>
                <div class="post-content">
                    <h2><a href="/post/{{ post.id }}">{{ post.title }}</a></h2>
                    <div class="post-meta">
                        <span class="author">
                            by <a href="/user/{{ post.username }}">{{ post.username }}</a>
                            {% if post.user_role == "verified_mechanic" %}
                            <span class="badge verified" title="Verified Mechanic">üîß‚úì</span>
                            {% elif post.user_role == "moderator" %}
                            <span class="badge mod" title="Moderator">üõ°Ô∏è</span>
                            {% elif post.user_role == "admin" %}
                            <span class="badge admin" title="Admin">‚≠ê</span>
                            {% endif %}
                        </span>
                        <span class="comments">üí¨ {{ post.comment_count | default(value=0) }}</span>
                        <span class="time">{{ post.created_at }}</span>
                    </div>
                </div>
            </article>
            {% else %}
            <p class="no-posts">No posts in this category yet.</p>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}
